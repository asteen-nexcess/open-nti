#############
## INPUT   ##
#############

########## INPUT NATIVE JTI ################
<source>
  @type udp
  tag jnpr.jti
  format juniper_jti
  port 50000
  bind 0.0.0.0
  message_length_limit 5000
</source>

########## INPUT Analyticsd ################
<source>
  @type udp
  tag jnpr.analyticsd
  format juniper_analyticsd
  message_length_limit 5000
  remove_newline false
  port 50020
  bind 0.0.0.0
</source>

#############
## OUTPUT  ##
#############

########## OUTPUT INFLUXDB ################
<match jnpr.**>
  @type copy
  <store>
   @type influxdb
   host influxdb
   port 8086
   dbname juniper
   user juniper
   password juniper
   value_keys ["value"]
     <buffer>
       @type memory
       #chunk_limit_size 524288 # 512 * 1024
       #chunk_limit_records 1024
       flush_interval 2
       #retry_limit 17
       #retry_wait 1.0
       #num_threads 1
    </buffer>
  </store>
</match>

 # Listen HTTP for monitoring
 # http://localhost:24220/api/plugins
 # http://localhost:24220/api/plugins?type=TYPE
 # http://localhost:24220/api/plugins?tag=MYTAG
 <source>
   @type monitor_agent
   @id monitor_agent_input
   port 24220
 </source>

 # Listen DRb for debug
 <source>
   @type debug_agent
   @id debug_agent_input
   bind 127.0.0.1
   port 24230
 </source>

 ## match tag=debug.** and dump to console
 <match debug.**>
   @type stdout
   @id stdout_output
 </match>

 # match fluent's internal events
 <match fluent.**>
   @type stdout
 </match>
